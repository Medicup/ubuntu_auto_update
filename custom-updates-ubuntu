#!/bin/bash -x
#This script allows for update, upgrade, and dist-upgrade
#Author: Stephen J Kennedy
#The file path is in a hidden directory in the /var/log./autoUpdate
#Filename will be the dailyUpdate

THISHOST=$(hostname -f)
DATE=$(date +"%F")
TIME=$(date +"%H:%M:%S")
LOGPATH="/bin/custom"
PID=$BASHPID
LOG="${LOGPATH}/log/${DATE}-${PID}-log"
TEMP="${LOGPATH}/.temp"
MAIL=/usr/bin/mail
TO="medicup@gmail.com"
UPDATE="upgrades dist-upgrade autoremove" #options for autoUpdate do statement

#mail Function uses mail to distribute results of autoUpdate
mailOutput(){
if [ $? -ne 0 ]
   then
      echo "mail error"
      $MAIL -s "Error with ${HOSTNAME} update: check ${UPDATE}." $TO < $LOG
   else
      echo "Success!"
      $MAIL -s ${DATE}-${THISHOST}  $TO < $LOG
fi
}

#autoUpdate function uses a do statement that will run until error or
#all update options are processed. It provides a start and success
#response that is exported to a text file

autoUpdate (){
echo "Starting update for $HOSTNAME at $TIME on ${DATE}." > $LOG
sudo apt-get update


for UPDATE in $UPDATE
do
   echo "Starting apt-get ${UPDATE}..." >> $LOG
   apt-get --assume-yes $UPDATE >> $LOG ||  return 1
   echo "apt-get ${UPDATE} successful!" >> $LOG
done
}

autoUpdate
mailOutput
exit 0
